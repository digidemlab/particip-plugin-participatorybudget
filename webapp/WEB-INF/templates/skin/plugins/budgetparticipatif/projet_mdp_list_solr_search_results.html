<section class="bg-color6">
  <#include "projet_search_solr_search_results.html">
  <div class="row">
    <div class="col-xs-12 col-sm-12">
      <div class="container">
        <div id="paginator"><strong>${paginator.itemsCount} projet(s) trouv&eacute;(s) </strong><@paginationSolr paginator=paginator /></div>
        <div id="resultItems" class="row">
      		<#assign theme_class = "autre">
          <#list results_list as result>
          	  <#assign id_document = "${(result.id?split('null_')?last)?split('_')?first}">
          <#assign result_detail_idx = ((paginator.pageCurrent-1)*paginator.itemsPerPage)+1+result_index>
        	<#if result.dynamicFields?? && result.dynamicFields.thematique_text??>
        		<#if result.dynamicFields.thematique_text = "Cadre de vie"><#assign theme_class = "cadre_vie">
          		<#elseif result.dynamicFields.thematique_text = "Culture" || result.dynamicFields.thematique_text = "Culture et patrimoine"><#assign theme_class = "culture">
          		<#elseif result.dynamicFields.thematique_text = "Economie et emploi"><#assign theme_class = "economie_emploi">
          		<#elseif result.dynamicFields.thematique_text = "Education et jeunesse"><#assign theme_class = "education">
          		<#elseif result.dynamicFields.thematique_text = "Environnement" || result.dynamicFields.thematique_text = "Nature en ville"><#assign theme_class = "environnement">
          		<#elseif result.dynamicFields.thematique_text = "Logement et habitat"><#assign theme_class = "logement">
          		<#elseif result.dynamicFields.thematique_text = "Participation citoyenne"><#assign theme_class = "participation_citoyenne">
          		<#elseif result.dynamicFields.thematique_text = "Prévention et sécurité"><#assign theme_class = "prevention_securite">
          		<#elseif result.dynamicFields.thematique_text = "Propreté"><#assign theme_class = "proprete">
          		<#elseif result.dynamicFields.thematique_text = "Solidarité" || result.dynamicFields.thematique_text = "Vivre ensemble"><#assign theme_class = "solidarite">
          		<#elseif result.dynamicFields.thematique_text = "Sport"><#assign theme_class = "sport">
          		<#elseif result.dynamicFields.thematique_text = "Transport et mobilité"><#assign theme_class = "transport">
          		<#elseif result.dynamicFields.thematique_text = "Ville intelligente et numérique"><#assign theme_class = "ville_numerique">
      		  </#if>
      		</#if>
          <div class="col-xs-12 col-sm-4 col-md-4">
            <div class="panel">
              <div class="panel-heading">
      						<div class="category project_${theme_class}">
                    <img class="logo-theme" src="images/local/skin/i_${theme_class}.png" alt="${result.dynamicFields.thematique_text}" title="${result.dynamicFields.thematique_text}"> ${result.dynamicFields.thematique_text}
                    <!--
                    <#if result.dynamicFields?? && result.dynamicFields.nombre_de_votes_long??>
        							${result.dynamicFields.nombre_de_votes_long} votes
        						<#else>
                      PROJET A CORRIGER
        						</#if>
                    -->
                  </div>
                  <div class="infos-projects">
                    <div class="project-location">
                    			 @Extender[${id_document},document,follow,{show:"favoris"}]@
          						<img src="images/local/skin/marker.png" width="25px" height="25px" alt="Localisation" title="Localisation">
                      <#if result.dynamicFields?? && result.dynamicFields.localisation_text??>
          							<#if result.dynamicFields.localisation_text = "Tout Paris">
          								${result.dynamicFields.localisation_text}
          							<#elseif result.dynamicFields.localisation_text?length &gt; 3>${result.dynamicFields.localisation_text?substring(0,3)}<#else>${result.dynamicFields.localisation_text}</#if>
          						</#if>
          					</div>
          					<div class="project-budget">
                      <img src="images/local/skin/money.png" width="25px" height="25px" alt="Budget" title="Budget">
                      <#if result.dynamicFields?? && result.dynamicFields.budget_long?? && result.dynamicFields.budget_long &gt; 0>
  							        <#setting locale="fr_FR">
  							          ${result.dynamicFields.budget_long?string("#,###")} &#8364;
  							        <#else>-
  							      </#if>
          					</div>
                  </div>
                </div>
                <div class="panel-title">
                  <h3>
                      <a href="jsp/site/Portal.jsp?page=search-solr&amp;conf=projects_mdp_detail&amp;items_per_page=1&amp;page_index=${result_detail_idx}&amp;prev_items_per_page=${nb_items_per_page!''}&amp;query=${query}<@EncodeFQ facets_list/>${monTri}" alt="${result.title}" title="${result.title}" >
                      <#if result.title?length &gt; 69>${result.title?substring(0,70)}<#else>${result.title}</#if>
                    </a>
                  </h3>
             
		 <div class="panel-body"> 
		        <#if result.summary?has_content>
		        <div class="summary">
		          <#if result.summary?length &gt; 200>${result.summary?substring(0,200)}…<#else>${result.summary}</#if>
		        </div>
		        </#if>
                
                </div>
                
              </div>
              <div class=""> 
			<#if campagneService.isDuring("VOTE") && voteValidated= false && arrondissementVote= "notConnected" >
			 	@Extender[${id_document},document,vote,{show:"all"}]@ 
			<#elseif campagneService.isDuring("VOTE") && voteValidated= false && (arrondissementVote == result.dynamicFields.localisation_text || result.dynamicFields.localisation_text= "Tout Paris")>
			 	@Extender[${id_document},document,vote,{show:"all"}]@ 
			</#if>
			<input type="hidden" name="localisation_${id_document}" id="localisation_${id_document}" value="${result.dynamicFields.localisation_text!}" />
			<input type="hidden" name="title_${id_document}" id="title_${id_document}" value="${result.title}" />
			<input type="hidden" name="thematique_${id_document}" id="thematique_${id_document}" value="${result.dynamicFields.thematique_text}" />
		     </div>
            </div>
        </div>
          </#list>
	  	</div>
	  	<div class="solr-paginator">
		    <@paginationSolr paginator=paginator />
		  </div>
    </div>

</section>
<#-- Freemarker macros -->
<#-- Number of items per page selector - Combo Box implementation -->
<#macro NbItemsPerPageSelectorCombo nb_items_per_page>
    <select name="items_per_page">
        <#list [ "10" , "20" , "50" , "100" ] as nb>
            <#if nb_items_per_page = nb >
                <option selected="selected" value="${nb}">${nb}</option>
            <#else>
                <option value="${nb}">${nb}</option>
            </#if>
        </#list>
    </select>
</#macro>

<#-- Number of items per page selector - Radio List implementation -->
<#macro NbItemsPerPageSelectorRadioList nb_items_per_page>
    <#list [ 5 , 10 , 20 , 50 ] as nb>
    <#if nb = nb_items_per_page >
    <input value="${nb}" id="items_per_page${nb}" name="items_per_page" class="radio" type="radio" checked /><label for="items_per_page${nb}">${nb}</label>
    <#else>
    <input value="${nb}" id="items_per_page${nb}" name="items_per_page" class="radio" type="radio" /><label for="items_per_page${nb}">${nb}</label>
    </#if>
    </#list>
</#macro>

<#macro paginationSolr paginator >
  <#assign nbLinkPages = 3 />
  <#assign offsetPrev = nbLinkPages/2 />
  <#assign offsetNext = nbLinkPages/2 />
  <#if paginator.pageCurrent &lt; nbLinkPages-offsetPrev>
    <#assign offsetPrev = nbLinkPages - paginator.pageCurrent />
    <#assign offsetNext = nbLinkPages - offsetPrev />
  <#elseif paginator.pageCurrent &gt; paginator.pagesCount - (nbLinkPages - offsetNext) >
    <#assign offsetNext = nbLinkPages - (paginator.pagesCount - paginator.pageCurrent) />
    <#assign offsetPrev = nbLinkPages - offsetNext />
  </#if>
	<br>
  <#if (paginator.pagesCount > 1) >
    <#if paginator.pageCurrent &gt; nbLinkPages-offsetPrev >
      <a class="paginator-navi-page" href="${paginator.firstPageLink?xhtml}${monTri}" alt="Premi&egrave;re page" title="Premi&egrave;re page">
				<span class="show-xs"></span><i class="fa fa-angle-double-left"></i>
			</a>
    </#if>
    <#if (paginator.pageCurrent > 1) >
     <a class="paginator-navi-page"  href="${paginator.previousPageLink?xhtml}${monTri}" alt="Page pr&eacute;c&eacute;dente" title="Page pr&eacute;c&eacute;dente">
			 <span class="show-xs"></span><i class="fa fa-angle-left"></i>
		 </a>
    </#if>
    <#if paginator.pageCurrent &gt; nbLinkPages-offsetPrev >
     <span class="paginator-sep-page">...</span>
    </#if>
    <#list paginator.pagesLinks as link>
      <#if ( link.index == paginator.pageCurrent )>
        <span class="paginator-current-page">${link.name}</span> <span class="paginator-sep-page">|</span>
      <#else>
        <a class="paginator-num-page" href="${link.url?xhtml}${monTri}">${link.name}</a> <span class="paginator-sep-page">|</span>
      </#if>
    </#list>
    <#if paginator.pageCurrent &lt; paginator.pagesCount - (nbLinkPages-offsetNext) >
      <span class="paginator-sep-page">...</span>
    </#if>
    <#if (paginator.pageCurrent < paginator.pagesCount) >
      <a class="paginator-navi-page"  href="${paginator.nextPageLink?xhtml}${monTri}" alt="Page suivante" title="Page suivante">
				<span class="show-xs"></span><i class="fa fa-angle-right"></i>
			</a>
      <#if paginator.pageCurrent &lt; paginator.pagesCount - (nbLinkPages-offsetNext) >
        <a class="paginator-navi-page" href="${paginator.lastPageLink?xhtml}${monTri}" alt="Derni&egrave;re page" title="Derni&egrave;re page">
					<span class="show-xs"></span><i class="fa fa-angle-double-right"></i>
				</a>
      </#if>
    </#if>
  </#if>
</#macro>