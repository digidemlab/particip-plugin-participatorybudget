<#include "/skin/plugins/asynchronousupload/upload_commons.html" />
<form class="form" role="form" method="post" action="jsp/site/Portal.jsp" enctype="multipart/form-data">
  
  <input type="hidden" name="action" value="save">
  <input type="hidden" name="page" value="mesInfos">
  <input type="hidden" name="completeInfos" value="<#if completeInfos?? && completeInfos>true<#else>false</#if>">
  <input type="hidden" name="token" value="${token}" id="token">

  <#if idExtendableResource??>
    <input type="hidden" name="idExtendableResource" value="${idExtendableResource}">
  </#if>
  <#if extendableResourceType??>
    <input type="hidden" name="extendableResourceType" value="${extendableResourceType}">
  </#if>
  <div class="form-group">
    <@messages errors=errors />
    <@messages infos=infos />
  </div>
  <div <#if campagneService.isDuring("VOTE") >style="display:none;"</#if>>
  	<div class="form-group">
    	<h3>Votre pseudo et votre avatar</h3>
    	<label class="sr-only" for="nickname">#i18n{budgetparticipatif.mes_infos.nickname} *</label>
    	<input class="form-control" type="text" name="nickname" id="budget-nickname" value="${nickname!''}" placeholder="#i18n{budgetparticipatif.mes_infos.nickname} *">
  	</div>
  	<div class="form-group">
    	<img class="img-circle" src="${avatar_url!''}" alt="Avatar" title="Avatar" />
    	<br>
    	<br>
    	<@addFileInputAndfilesBox fieldName="avatar_image" handler=handler listUploadedFiles=[] inputCssClass='form-control' multiple=false singleUpload=true/>
  	</div>
  </div>
  <#if !is_for_popup>
    <div class="form-group">
      <h3>Votre adresse mail et votre mot de passe</h3>
      <label class="sr-only" for="login">#i18n{budgetparticipatif.mes_infos.login} *</label>
      <input class="form-control" type="text" name="login" id="budget-login" value="${login!''}" placeholder="#i18n{budgetparticipatif.mes_infos.login} *">
      <a data-toggle="collapse" href="#modify_password">Changer mon mot de passe</a>
      <div id="modify_password" class="collapse">
        <div class="form-group">
          <label for="password">#i18n{budgetparticipatif.mes_infos.password} *</label>
          <input class="form-control" type="password" name="password" id="budget-password" value="" autocomplete="off" placeholder="#i18n{budgetparticipatif.mes_infos.password}">
        </div>
        <div class="form-group">
          <label class="sr-only" for="confirmation_password">#i18n{budgetparticipatif.mes_infos.confirmationPassword} *</label>
          <input class="form-control" type="password" name="confirmation_password" id="budget-confirmation-password" value="" autocomplete="off" placeholder="#i18n{budgetparticipatif.mes_infos.confirmationPassword} ">
        </div>
      </div>
    </div>
  </#if>
  <div class="form-group">
    <h3>Vos informations personnelles</h3>
    <#assign chk_civility_MME="" />
    <#assign chk_civility_M="" />
    <#assign chk_civility_NPR="" />

    <#if civility?? && civility=="MME">
      <#assign chk_civility_MME="checked" />
      <#elseif civility?? && civility=="M">
        <#assign chk_civility_M="checked" />
      <#elseif civility?? && civility=="NPR">
        <#assign chk_civility_NPR="checked" />
    </#if>
    <div class="form-group">
      <label for="civility" class="radio-inline">
        <input type="radio" name="civility" id="budget-civility" value="MME" ${chk_civility_MME}>#i18n{campagnebp.mes_infos.civilityMme}
      </label>
      <label for="civility" class="radio-inline">
        <input type="radio" name="civility" id="budget-civility" value="M" ${chk_civility_M}>#i18n{campagnebp.mes_infos.civilityM}
      </label>
      <label for="civility" class="radio-inline">
        <input type="radio" name="civility" id="budget-civility" value="NPR" ${chk_civility_NPR}>#i18n{campagnebp.mes_infos.civilityNPR} *
      </label>
    </div>
    <div <#if campagneService.isDuring("VOTE") >style="display:none;"</#if>>
    	<div class="form-group">
      		<label class="sr-only" for="lastname">#i18n{campagnebp.mes_infos.lastname} </label>
      		<input class="form-control" type="text" name="lastname" id="budget-lastname" value="${lastname!''}" placeholder="#i18n{campagnebp.mes_infos.lastname} ">
    	</div>
    	<div class="form-group">
      		<label class="sr-only" for="firstname">#i18n{campagnebp.mes_infos.firstname}</label>
      		<input class="form-control" type="text" name="firstname" id="budget-firstname" value="${firstname!''}" placeholder="#i18n{campagnebp.mes_infos.firstname} ">
    	</div>
    </div>
    <div class="form-group">
      <input class="form-control" type="text" name="birthdate" id="budget-birthdate" value="${birthdate!''}" placeholder="#i18n{campagnebp.mes_infos.birthdate} *">
    </div>
     <div class="form-group">
             <label   for="arrondissement" class="sr-only" >#i18n{budgetparticipatif.mes_infos.arrondissement} *</label>
             <@comboWithParams name="arrondissement" items=arrondissements_list default_value="${arrondissement!''}" additionalParameters="class='form-control'" />
     </div>
    <div class="form-group">
      <label class="sr-only" for="address">#i18n{campagnebp.mes_infos.address} *</label>
      <div class="input-group">
        <input type="text" class="form-control" name="address" id="budget-address" value="${address!''}" placeholder="#i18n{campagnebp.mes_infos.address} *">
        <span class="input-group-btn">
          <button class="btn btn-default" type="button" title="effacer" id="button_delete_adress"><i class="fa fa-times"></i></button>
        </span>
      </div>
      <#if !authorized_address>
        <p class="alert alert-danger">#i18n{campagnebp.mes_infos.unauthorizedAddress}</p>
      </#if>
    </div>
    <input id="geojson" type="hidden" name="geojson" value="${(geoJson?html)!''}">
    <input id="geojson_state" type="hidden">
  </div>
  <#if !account_verified>
    <div class="form-group">
      <div class="checkbox">
        <label>
          <#assign chk_send_account_validation="" />
          <#if send_account_validation?? && ( send_account_validation=="on" ||send_account_validation=="default" )>
            <#assign chk_send_account_validation="checked" />
          </#if>
          <input type="checkbox" name="sendaccountvalidation" id="budget-sendaccountvalidation" ${chk_send_account_validation}> #i18n{campagnebp.mes_infos.sendAccountValidation}
        </label>
      </div>
    </div>
  </#if>
  <div class="form-group">
    <div class="checkbox">
      <label>
        <#assign chk_iliveinparis="" />
        <#if iliveinparis?? && ( iliveinparis=="on"  )>
          <#assign chk_iliveinparis="checked" />
        </#if>
        <input type="checkbox" name="iliveinparis" id="budget-iliveinparis" ${chk_iliveinparis}> #i18n{campagnebp.mes_infos.cb.iLiveInParis} *
      </label>
    </div>
  </div>
  <div class="form-group">
    <div class="checkbox">
      <label>
        <#assign chk_stayconnected="" />
        <#if stayconnected?? && ( stayconnected=="on" ||stayconnected=="default" )>
          <#assign chk_stayconnected="checked" />
        </#if>
        <input type="checkbox" name="stayconnected" id="budget-stayconnected" ${chk_stayconnected}> #i18n{campagnebp.mes_infos.cb.stayConnected}
      </label>
    </div>
  </div>
  <#if captcha?exists>
    <div class="form-group">
      ${captcha}
    </div>
  </#if>
  <div class="form-group text-center">
    <button id="budgetparticipatif-profile-button" class="btn btn-idee" type="submit">#i18n{campagnebp.mes_infos.bt.save}</button>
    <#if completeInfos?? && completeInfos && from_url?? && from_url !=''>
      <a  class="btn btn-primary" href="${from_url!}" title="#i18n{portal.util.labelBack}">
         #i18n{portal.util.labelBack}
        </a>
    </#if>
  </div>
</form>
<#if !is_for_popup && (password?? || confirmation_password??)>
  <script>
    $(function() {
      $('#modify_password').show('bounce');
    });
  </script>
</#if>

<script type="text/javascript" src="jsp/site/plugins/asynchronousupload/GetMainUploadJs.jsp?handler=campagnebpUploadHandler"></script>
<script type="text/javascript" src="js/proj4js-combined.js"></script>
<script type="text/javascript" src="jsp/site/plugins/address/modules/autocomplete/SetupSuggestPOI.js.jsp"></script>
<script type="text/javascript" src="js/plugins/address/modules/autocomplete/jQuery.suggestPOI.js"></script>
<script src="js/jquery/plugins/mask/jquery.mask.min.js"></script>
<script type='text/javascript'>
  $(function() {
    $(window).load(function() {
      /*suggestpoi*/

      initMyInfoAddressAutoComplete();
      $("#budget-birthdate").mask("00/00/0000", {
        placeholder: "Date de naissance : __/__/____ *"
      });

    });

  });
</script>
